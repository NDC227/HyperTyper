extends Node


# Declare member variables here. Examples:
var title = ""
var input = ""
var savelocation = ""
var words = []
var sets = []

# Called when the node enters the scene tree for the first time.
func _ready():
	$Control/SetSelect.get_popup().connect("id_pressed", self, "_on_item_pressed")
	loadGame()


# Called every frame. 'delta' is the elapsed time since the previous frame.
#func _process(delta):
#	pass

func _on_item_pressed(ID):
	var node = $Control/SetSelect.get_popup().get_item_text(ID)
	var save_game = File.new()
	save_game.open(node, File.READ)
	var node_data = save_game.get_as_text()
	words = node_data.split("\n")
	save_game.close()
	title = node.substr(7, title.length()-5)
	$Control/SetTitle.text = title
	$Control/WordInput.text = ""
	for word in words:
		$Control/WordInput.text += word.substr(1, word.length()-2) + "\n"

func loadGame():
	var save_game = File.new()
	save_game.open("user://WAWCustomLists.save", File.READ)
	var node_data = save_game.get_as_text()
	sets = node_data.split("\n")
	save_game.close()

func saveGame():
	var save_game = File.new()
	save_game.open("user://WAWCustomLists.save", File.WRITE)
	var save_nodes = get_tree().get_nodes_in_group("save")
	for node in save_nodes:
		var node_data = savelocation
		save_game.store_line(to_json(node_data))
	save_game.close()

func _on_Save_pressed():
	#process data to be saved
	words = []
	title = $Control/SetTitle.text.strip_edges()
	while " " in title:
		title = title.replace(" ", "")
	savelocation = "user://" + title
	input = $Control/WordInput.text
	var regex = RegEx.new()
	regex.compile("\\S+") # Negated whitespace character class.
	var results = regex.search_all(input)
	for result in results:
		words.push_back(result.get_string())
	for i in range (words.size()-1):
		words[i] = words[i].to_lower()
	#saves words in file
	var save_game = File.new()
	save_game.open(savelocation, File.WRITE)
	for word in words:
		save_game.store_line(to_json(word))
	save_game.close()
	#saves filename to set database
	saveGame()

func _on_Load_pressed():
	loadGame()
	$Control/SetSelect.get_popup().clear()
	for i in range (len(sets)-1):
		#$Control/RichTextLabel.text += sets[i].substr(1, sets[i].length()-2)
		$Control/SetSelect.get_popup().add_item(sets[i].substr(1, sets[i].length()-2))

func _on_Button_pressed():
	var dir = Directory.new()
	dir.remove("user://DippoWords\t.save")
